<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="search.css">
    <link rel="stylesheet" href="rScore.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recyclability Calculator - Green Index</title>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <a href="index.html" style="font-size: 1.5rem; font-weight: bold; color: white; text-decoration: none;"> Green Index</a>
        <div class="nav-right">
            <div class="nav-links">
                <a href="index.html">Home</a>
                <a href="search.html">Search</a>
                <a href="rScore.html">Calculator</a>
                <a href="overview.html">Overview</a>
            </div>
            <div class="nav-search">
                <input type="text" id="search-input" placeholder="Search materials...">
                <button id="search-btn">Search</button>
            </div>
        </div>
    </nav>

    <div class="calculator-container">
        <header class="calculator-header">
            <h1>Recyclability Calculator</h1>
            <p>Enter material properties to calculate its recyclability score</p>
        </header>

        <div class="main-content">
            <section class="input-section">
                <div class="form-card">
                    <h3>Material Properties</h3>
                    <div class="input-group">
                        <label for="category-select">Material Category</label>
                        <select id="category-select">
                            <option value="">Select Category</option>
                            <option value="Metal">Metal</option>
                            <option value="Polymer">Polymer</option>
                            <option value="Ceramic">Ceramic</option>
                            <option value="Glass">Glass</option>
                            <option value="Composite">Composite</option>
                        </select>
                    </div>

                    <!-- Common Properties -->
                    <div class="input-group">
                        <label for="thermal-stability">Thermal Stability</label>
                        <select id="thermal-stability">
                            <option value="">Select Stability</option>
                            <option value="Low">Low</option>
                            <option value="Moderate">Moderate</option>
                            <option value="High">High</option>
                            <option value="Very High">Very High</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label for="density">Density (g/cm³)</label>
                        <input type="number" id="density" placeholder="Enter density" step="0.01" min="0">
                    </div>

                    <div class="input-group">
                        <label for="toxicity">Toxicity Level</label>
                        <select id="toxicity">
                            <option value="">Select Toxicity</option>
                            <option value="Low">Low</option>
                            <option value="Moderate">Moderate</option>
                            <option value="High">High</option>
                            <option value="Very High">Very High</option>
                        </select>
                    </div>

                    <!-- Metal-specific Properties -->
                    <div id="metal-properties" class="category-properties" style="display: none;">
                        <h4>Metal Properties</h4>
                        <div class="input-group">
                            <label for="magnetism">Magnetism</label>
                            <select id="magnetism">
                                <option value="">Select Type</option>
                                <option value="Ferrous">Ferrous</option>
                                <option value="Non-ferrous">Non-ferrous</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="melting-point">Melting Point (°C)</label>
                            <input type="number" id="melting-point" placeholder="Enter melting point" min="0">
                        </div>
                    </div>

                    <!-- Polymer-specific Properties -->
                    <div id="polymer-properties" class="category-properties" style="display: none;">
                        <h4>Polymer Properties</h4>
                        <div class="input-group">
                            <label for="polymer-type">Polymer Type</label>
                            <select id="polymer-type">
                                <option value="">Select Type</option>
                                <option value="PMMA">PMMA</option>
                                <option value="Epoxy">Epoxy</option>
                                <option value="Melamine">Melamine</option>
                                <option value="Nylon">Nylon</option>
                                <option value="PC">PC</option>
                                <option value="Polyester">Polyester</option>
                                <option value="HDPE">HDPE</option>
                                <option value="LDPE">LDPE</option>
                                <option value="PET">PET</option>
                                <option value="POM">POM</option>
                                <option value="PP">PP</option>
                                <option value="PS">PS</option>
                                <option value="PTFE">PTFE</option>
                                <option value="PVC">PVC</option>
                                <option value="Butyl">Butyl</option>
                                <option value="Natural">Natural</option>
                                <option value="NBR">NBR</option>
                                <option value="PU">PU</option>
                                <option value="Silicone">Silicone</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="additives">Contains Additives</label>
                            <select id="additives">
                                <option value="">Select Option</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="polymer-melting-point">Melting Point (°C)</label>
                            <input type="number" id="polymer-melting-point" placeholder="Enter melting point (if applicable)" min="0">
                        </div>
                    </div>

                    <!-- Ceramic-specific Properties -->
                    <div id="ceramic-properties" class="category-properties" style="display: none;">
                        <h4>Ceramic Properties</h4>
                        <div class="input-group">
                            <label for="ceramic-melting-point">Melting Point (°C)</label>
                            <input type="number" id="ceramic-melting-point" placeholder="Enter melting point (if applicable)" min="0">
                        </div>
                    </div>

                    <!-- Glass-specific Properties -->
                    <div id="glass-properties" class="category-properties" style="display: none;">
                        <h4>Glass Properties</h4>
                        <div class="input-group">
                            <label for="glass-melting-point">Melting Point (°C)</label>
                            <input type="number" id="glass-melting-point" placeholder="Enter melting point" min="0">
                        </div>
                    </div>

                    <!-- Composite-specific Properties -->
                    <div id="composite-properties" class="category-properties" style="display: none;">
                        <h4>Composite Properties</h4>
                        <div class="input-group">
                            <label for="composite-additives">Contains Additives</label>
                            <select id="composite-additives">
                                <option value="">Select Option</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="composite-melting-point">Processing Temperature (°C)</label>
                            <input type="number" id="composite-melting-point" placeholder="Enter processing temperature" min="0">
                        </div>
                    </div>

                    <!-- Calculate Button -->
                    <div class="button-group">
                        <button id="calculate-btn" class="btn-primary">Calculate Recyclability Score</button>
                        <button id="reset-btn" class="btn-secondary">Reset Form</button>
                    </div>
                </div>
            </section>

            <!-- Results Section -->
            <section class="results-section">
                <div class="results-card" id="results-container" >
                    <h3>Recyclability Assessment</h3>
                    
                    <div class="score-display">
                        <div class="score-circle" id="score-circle">
                            <span class="score-value" id="score-value">0</span>
                            <span class="score-max">/10</span>
                        </div>
                        <div class="score-info">
                            <h4 id="score-rating">Rating</h4>
                            <p id="score-description">Description</p>
                        </div>
                    </div>

                    <div class="score-breakdown">
                        <h4>Score Breakdown</h4>
                        <div class="breakdown-grid">
                            <div class="breakdown-item">
                                <span class="breakdown-label">Material Category:</span>
                                <span class="breakdown-value" id="category-score">-</span>
                            </div>
                            <div class="breakdown-item">
                                <span class="breakdown-label">Thermal Properties:</span>
                                <span class="breakdown-value" id="thermal-score">-</span>
                            </div>
                            <div class="breakdown-item">
                                <span class="breakdown-label">Toxicity Impact:</span>
                                <span class="breakdown-value" id="toxicity-score">-</span>
                            </div>
                            <div class="breakdown-item">
                                <span class="breakdown-label">Processing Ease:</span>
                                <span class="breakdown-value" id="processing-score">-</span>
                            </div>
                            <div class="breakdown-item">
                                <span class="breakdown-label">Market Demand:</span>
                                <span class="breakdown-value" id="demand-score">-</span>
                            </div>
                            <div class="breakdown-item">
                                <span class="breakdown-label">Contamination Risk:</span>
                                <span class="breakdown-value" id="contamination-score">-</span>
                            </div>
                        </div>
                    </div>

                    <div class="recommendations">
                        <h4>Recycling Recommendations</h4>
                        <div id="recommendations-list">
                            <!-- Recommendations will be populated by JavaScript -->
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button class="btn-primary" id="save-result-btn">Save Result</button>
                        <button class="btn-secondary" id="print-result-btn">Print Assessment</button>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-container">
            <div class="footer-content">
                <div class="footer-section">
                    <h2>Green Index</h2>
                    <p>Behind Every Bin Is a Better Decision.</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="search.html">Search Materials</a></li>
                        <li><a href="overview.html">Materials Overview</a></li>
                        <li><a href="rScore.html">Calculate Score</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Disclaimer:</h4>
                    <p>This website is for informational purposes only. The information provided should not be used as the sole basis for making environmental or recycling decisions. We do not accept any responsibility or liability for actions taken based on this information.</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Category property visibility handler
        document.getElementById('category-select').addEventListener('change', function() {
            const category = this.value;
            const allProperties = document.querySelectorAll('.category-properties');
            
            // Hide all category-specific properties
            allProperties.forEach(prop => prop.style.display = 'none');
            
            // Show relevant properties based on category
            if (category === 'Metal') {
                document.getElementById('metal-properties').style.display = 'block';
            } else if (category === 'Polymer') {
                document.getElementById('polymer-properties').style.display = 'block';
            } else if (category === 'Ceramic') {
                document.getElementById('ceramic-properties').style.display = 'block';
            } else if (category === 'Glass') {
                document.getElementById('glass-properties').style.display = 'block';
            } else if (category === 'Composite') {
                document.getElementById('composite-properties').style.display = 'block';
            }
        });

        // Search functionality
        document.getElementById('search-btn').addEventListener('click', function() {
            const searchTerm = document.getElementById('search-input').value;
            if (searchTerm.trim()) {
                window.location.href = `search.html?q=${encodeURIComponent(searchTerm)}`;
            } else {
                window.location.href = 'search.html';
            }
        });

        document.getElementById('search-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('search-btn').click();
            }
        });

        // Find similar materials function
        function findSimilarMaterials(inputMaterial) {
            // List of materials from CSV (hardcoded for demo, ideally loaded dynamically)
            const materialsList = [
                {Material:'Aluminum',Category:'Metal','Thermal Stability':'High',Magnetism:'Non-ferrous','Melting Point':660, Density:2.7, Toxicity:'Low', 'Polymer Type':'', Additives:'No'},
                {Material:'Copper',Category:'Metal','Thermal Stability':'High',Magnetism:'Non-ferrous','Melting Point':1085, Density:8.96, Toxicity:'Low', 'Polymer Type':'', Additives:'No'},
                {Material:'HDPE (High Density Polyethylene)',Category:'Polymer','Thermal Stability':'Low',Magnetism:'Non-magnetic','Melting Point':130, Density:0.95, Toxicity:'Low', 'Polymer Type':'HDPE', Additives:'No'},
                {Material:'PET (Polyethylene Terephthalate)',Category:'Polymer','Thermal Stability':'Moderate',Magnetism:'Non-magnetic','Melting Point':260, Density:1.38, Toxicity:'Low', 'Polymer Type':'PET', Additives:'No'},
                {Material:'Brick',Category:'Ceramic','Thermal Stability':'High',Magnetism:'Non-magnetic','Melting Point':2000, Density:1.8, Toxicity:'Low', 'Polymer Type':'', Additives:'No'},
                {Material:'Soda-lime Glass',Category:'Glass','Thermal Stability':'High',Magnetism:'Non-magnetic','Melting Point':573, Density:2.5, Toxicity:'Low', 'Polymer Type':'', Additives:'No'},
                {Material:'CFRP (Carbon Fiber Reinforced Polymer)',Category:'Composite','Thermal Stability':'High',Magnetism:'Non-magnetic','Melting Point':350, Density:1.6, Toxicity:'Moderate', 'Polymer Type':'', Additives:'Yes'}
                // ...add more as needed
            ];
            // Find similar materials by category and close melting point/density
            return materialsList.filter(mat => {
                if (mat.Category !== inputMaterial.Category) return false;
                if (Math.abs(mat['Melting Point'] - inputMaterial['Melting Point']) > 100) return false;
                if (Math.abs(mat.Density - inputMaterial.Density) > 0.5) return false;
                if (mat.Toxicity !== inputMaterial.Toxicity) return false;
                if (inputMaterial.Category === 'Polymer' && mat['Polymer Type'] && inputMaterial['Polymer Type'] && mat['Polymer Type'] !== inputMaterial['Polymer Type']) return false;
                return true;
            });
        }

        // Calculate recyclability score
        document.getElementById('calculate-btn').addEventListener('click', function() {
            const materialData = collectFormData();
            if (validateFormData(materialData)) {
                const score = calculateRecyclabilityScore(materialData);
                document.getElementById('results-container').style.display = 'block';
                document.getElementById('score-value').textContent = score.toFixed(1);
                let ratingClass, ratingText, description;
                if (score >= 8) {
                    ratingClass = 'excellent';
                    ratingText = 'Excellent';
                    description = 'This material has excellent recyclability potential with minimal processing challenges.';
                } else if (score >= 6) {
                    ratingClass = 'good';
                    ratingText = 'Good';
                    description = 'This material has good recyclability potential with some processing considerations.';
                } else if (score >= 4) {
                    ratingClass = 'moderate';
                    ratingText = 'Moderate';
                    description = 'This material has moderate recyclability potential but may face significant challenges.';
                } else {
                    ratingClass = 'poor';
                    ratingText = 'Poor';
                    description = 'This material has poor recyclability potential and significant processing challenges.';
                }
                document.getElementById('score-circle').className = `score-circle ${ratingClass}`;
                document.getElementById('score-rating').textContent = ratingText;
                document.getElementById('score-description').textContent = description;
                // Find and display similar materials
                const similar = findSimilarMaterials(materialData);
                let similarHtml = '<div class="similar-materials-container"><h4>Possible Similar Materials</h4>';
                if (similar.length > 0) {
                    similarHtml += '<ul class="similar-materials-list">';
                    similar.forEach(mat => {
                        similarHtml += `<li class="similar-material-item"><span class="material-name">${mat.Material}</span> <span class="material-category">(${mat.Category})</span> <span class="material-details">Melting Point: ${mat['Melting Point']}°C, Density: ${mat.Density}</span></li>`;
                    });
                    similarHtml += '</ul>';
                } else {
                    similarHtml += '<div class="similar-material-item">No close matches found. This may be a unique or unknown material.</div>';
                }
                similarHtml += '</div>';
                let resultsContainer = document.getElementById('results-container');
                let similarDiv = document.getElementById('similar-materials-list');
                if (!similarDiv) {
                    similarDiv = document.createElement('div');
                    similarDiv.id = 'similar-materials-list';
                    resultsContainer.appendChild(similarDiv);
                }
                similarDiv.innerHTML = similarHtml;
            }
        });

        // Reset form
        document.getElementById('reset-btn').addEventListener('click', function() {
            document.querySelector('.form-card').reset();
            document.querySelectorAll('.category-properties').forEach(prop => prop.style.display = 'none');
            document.getElementById('results-container').style.display = 'none';
        });

        // Print results
        document.getElementById('print-result-btn').addEventListener('click', function() {
            window.print();
        });

        // Save results (placeholder for future implementation)
        document.getElementById('save-result-btn').addEventListener('click', function() {
            alert('Save functionality will be implemented with backend integration');
        });

        function collectFormData() {
            const category = document.getElementById('category-select').value;
            const data = {
                Category: category,
                'Thermal Stability': document.getElementById('thermal-stability').value,
                Density: parseFloat(document.getElementById('density').value) || 0,
                Toxicity: document.getElementById('toxicity').value
            };

            // Add category-specific properties
            if (category === 'Metal') {
                data.Magnetism = document.getElementById('magnetism').value;
                data['Melting Point'] = parseFloat(document.getElementById('melting-point').value) || 0;
            } else if (category === 'Polymer') {
                data['Polymer Type'] = document.getElementById('polymer-type').value;
                data.Additives = document.getElementById('additives').value;
                data['Melting Point'] = parseFloat(document.getElementById('polymer-melting-point').value) || 0;
            } else if (category === 'Ceramic') {
                data['Melting Point'] = parseFloat(document.getElementById('ceramic-melting-point').value) || 0;
            } else if (category === 'Glass') {
                data['Melting Point'] = parseFloat(document.getElementById('glass-melting-point').value) || 0;
            } else if (category === 'Composite') {
                data.Additives = document.getElementById('composite-additives').value;
                data['Melting Point'] = parseFloat(document.getElementById('composite-melting-point').value) || 0;
            }

            return data;
        }

        function validateFormData(data) {
            if (!data.Category || !data['Thermal Stability'] || !data.Toxicity) {
                alert('Please fill in all required fields');
                return false;
            }
            return true;
        }

        function calculateRecyclabilityScore(material) {
            let score = 0;

            const categoryScores = {
                'Metal': 3.0,
                'Glass': 2.0,
                'Polymer': 1.5,
                'Ceramic': 0.8,
                'Composite': 0.5
            };
            score += categoryScores[material.Category] || 0;

            // Thermal Stability (0–2), slightly adjusted for recyclability logic
            const thermalScores = {
                'Low': 0.5,
                'Moderate': 1.0,
                'High': 0.7,
                'Very High': 0.3
            };
            score += thermalScores[material['Thermal Stability']] || 0;

            // Reactivity not present in form
            const magneticScore = (material.Category === 'Metal' && material.Magnetism === 'Ferrous') ? 1.2 : 0.5;
            score += magneticScore;

            // Melting Point (0–1.5), material-specific
            const meltingPoint = parseFloat(material['Melting Point']);
            if (material.Category === 'Polymer') {
                if (meltingPoint < 200) score += 1.0;
                else if (meltingPoint < 350) score += 0.7;
                else score += 0.3;
            } else if (material.Category === 'Metal') {
                if (meltingPoint < 800) score += 0.5;
                else if (meltingPoint < 1500) score += 0.8;
                else score += 0.3;
            } else if (material.Category === 'Glass' || material.Category === 'Ceramic') {
                if (meltingPoint < 1000) score += 0.7;
                else if (meltingPoint < 1600) score += 0.5;
                else score += 0.3;
            }

            // Density (0–1), general heuristic
            const density = material.Density;
            if (density < 1.0) score += 0.5;
            else if (density < 3.0) score += 0.3;

            // Toxicity (0–2), inverse score
            const toxicityScores = {
                'Low': 1.0,
                'Moderate': 0.5,
                'High': 0.2,
                'Very High': 0.0
            };
            score += toxicityScores[material.Toxicity] || 0;

            // Polymer Type (0–1.5) – only if polymer
            const polymerTypeScores = {
                'PET': 0.5,
                'HDPE': 0.5,
                'PP': 0.3,
                'PVC': 0.2,
                'PS': 0.2,
                'Other': 0.0
            };
            if (material.Category === 'Polymer') {
                score += polymerTypeScores[material['Polymer Type']] || 0;
            }

            // Additives (penalty of up to -1)
            if (material.Category === 'Polymer' && material.Additives === 'Yes') {
                score -= 0.5;
            }
            let demandScore = 0.3;
            if (material.Category === 'Metal') {
                demandScore = material.Magnetism === 'Ferrous' ? 1.0 : 0.6;
            } else if (material.Category === 'Glass') {
                demandScore = 0.5;
            } else if (material.Category === 'Polymer') {
                demandScore = ['PET','HDPE'].includes(material['Polymer Type']) ? 0.7 : 0.3;
            } else if (material.Category === 'Ceramic') {
                demandScore = 0.2;
            } else if (material.Category === 'Composite') {
                demandScore = 0.1;
            }
            score += demandScore;

            return Math.min(Math.max(Math.round(score * 100) / 100, 0), 10);
        }

        function displayResults(scoreData, materialData) {
            const resultsContainer = document.getElementById('results-container');
            const scoreValue = document.getElementById('score-value');
            const scoreCircle = document.getElementById('score-circle');
            const scoreRating = document.getElementById('score-rating');
            const scoreDescription = document.getElementById('score-description');

            // Display total score
            const totalScore = scoreData.total.toFixed(1);
            scoreValue.textContent = totalScore;

            // Set score circle color and rating
            let ratingClass, ratingText, description;
            if (totalScore >= 8) {
                ratingClass = 'excellent';
                ratingText = 'Excellent';
                description = 'This material has excellent recyclability potential with minimal processing challenges.';
            } else if (totalScore >= 6) {
                ratingClass = 'good';
                ratingText = 'Good';
                description = 'This material has good recyclability potential with some processing considerations.';
            } else if (totalScore >= 4) {
                ratingClass = 'moderate';
                ratingText = 'Moderate';
                description = 'This material has moderate recyclability potential but may face significant challenges.';
            } else {
                ratingClass = 'poor';
                ratingText = 'Poor';
                description = 'This material has poor recyclability potential and significant processing challenges.';
            }

            scoreCircle.className = `score-circle ${ratingClass}`;
            scoreRating.textContent = ratingText;
            scoreDescription.textContent = description;

            // Display breakdown scores
            document.getElementById('category-score').textContent = scoreData.breakdown.category.toFixed(1);
            document.getElementById('thermal-score').textContent = scoreData.breakdown.thermal.toFixed(1);
            document.getElementById('toxicity-score').textContent = scoreData.breakdown.toxicity.toFixed(1);
            document.getElementById('processing-score').textContent = scoreData.breakdown.processing.toFixed(1);
            document.getElementById('demand-score').textContent = scoreData.breakdown.demand.toFixed(1);
            document.getElementById('contamination-score').textContent = scoreData.breakdown.contamination.toFixed(1);

            // Generate recommendations
            generateRecommendations(materialData, scoreData);

            // Show results
            resultsContainer.style.display = 'block';
            resultsContainer.scrollIntoView({ behavior: 'smooth' });
        }

        function generateRecommendations(materialData, scoreData) {
            const recommendationsList = document.getElementById('recommendations-list');
            const recommendations = [];

            if (materialData.toxicity === 'High' || materialData.toxicity === 'Very High') {
                recommendations.push('Special handling required due to high toxicity - ensure proper safety protocols');
            }

            if (materialData.category === 'Metal' && materialData.magnetism === 'Ferrous') {
                recommendations.push('Can utilize magnetic separation for efficient sorting');
            }

            if (materialData.category === 'Polymer' && materialData.additives === 'Yes') {
                recommendations.push('May require additive removal or separation before recycling');
            }

            if (scoreData.total < 4) {
                recommendations.push('Consider alternative disposal methods or specialized recycling facilities');
            }

            if (materialData.category === 'Composite') {
                recommendations.push('Complex material separation may be required - consider specialized recycling programs');
            }

            if (recommendations.length === 0) {
                recommendations.push('Standard recycling processes should be suitable for this material');
            }

            recommendationsList.innerHTML = recommendations.map(rec => `<p class="recommendation-item">${rec}</p>`).join('');
        }
    </script>
</body>
</html>