<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Green Index - Materials Overview</title>
    <link rel="stylesheet" href="search.css">
    <link rel="stylesheet" href="overview.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <nav class="navbar">
        <a href="index.html" style="font-size: 1.5rem; font-weight: bold; color: white; text-decoration: none;"> Green Index</a>
        <div class="nav-right">
            <div class="nav-links">
                <a href="index.html">Home</a>
                <a href="search.html">Search</a>
                <a href="overview.html">Overview</a>
                <a href="rScore.html">Calculator</a>
            </div>
            <div class="nav-search">
                <input type="text" id="search-input" placeholder="Search materials...">
                <button id="search-btn">Search</button>
            </div>
        </div>
    </nav>

    <div class="overview-container">
        <nav class="breadcrumb">
            <a href="index.html">Home</a>
            <span class="separator">></span>
            <span class="current">Materials Overview</span>
        </nav>

        <header class="overview-header">
            <h1>Materials Recyclability Overview</h1>
            <p>Comprehensive analysis of recyclability scores and environmental impact</p>
        </header>

        <section class="summary-section">
            <div class="summary-grid">
                <div class="summary-card">
                    <h3>Total Materials</h3>
                    <span class="summary-value" id="total-materials">0</span>
                    <p>Materials analyzed</p>
                </div>
                <div class="summary-card">
                    <h3>Best Category</h3>
                    <span class="summary-value" id="best-category">-</span>
                    <p>Highest rated category</p>
                </div>
                <div class="summary-card">
                    <h3>High Risk Materials</h3>
                    <span class="summary-value" id="high-risk">0</span>
                    <p>Materials with toxicity concerns</p>
                </div>
            </div>
        </section>

        <section class="charts-section">
            <div class="charts-grid">
                <div class="chart-container">
                    <h3>Recyclability Score by Category</h3>
                    <canvas id="categoryChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>Thermal Stability by Category</h3>
                    <canvas id="thermalChart"></canvas>
                </div>
            </div>
        </section>
        <section class="table-section">
            <div class="table-container">
                <h3>Detailed Materials Analysis</h3>
                <div class="table-controls">
                    <select id="category-filter">
                        <option value="">All Categories</option>
                        <option value="Metal">Metal</option>
                        <option value="Polymer">Polymer</option>
                        <option value="Ceramic">Ceramic</option>
                        <option value="Glass">Glass</option>
                        <option value="Composite">Composite</option>
                    </select>
                    <select id="toxicity-filter">
                        <option value="">All Toxicity Levels</option>
                        <option value="Low">Low</option>
                        <option value="Moderate">Moderate</option>
                        <option value="High">High</option>
                        <option value="Very High">Very High</option>
                    </select>
                    <input type="text" id="search-filter" placeholder="Search materials...">
                </div>
                <div class="table-wrapper">
                    <table id="materials-table">
                        <thead>
                            <tr>
                                <th>Material</th>
                                <th>Category</th>
                                <th>Recyclability Score</th>
                                <th>Toxicity</th>
                                <th>Thermal Stability</th>
                                <th>Melting Point (Â°C)</th>
                                <th>Density</th>
                            </tr>
                        </thead>
                        <tbody id="materials-tbody"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <section class="insights-section">
            <div class="insights-container">
                <h3>Key Insights</h3>
                <div class="insights-grid" id="insights-grid"></div>
            </div>
        </section>
    </div>

    <footer class="footer">
        <div class="footer-container">
            <div class="footer-content">
                <div class="footer-section">
                    <h2>Green Index</h2>
                    <p>Behind Every Bin Is a Better Decision.</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="search.html">Search Materials</a></li>
                        <li><a href="overview.html">Materials Overview</a></li>
                        <li><a href="rScore.html">Calculate Score</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Disclaimer:</h4>
                    <p>This website is for informational purposes only. The information provided should not be used as the sole basis for making environmental or recycling decisions. We do not accept any responsibility or liability for actions taken based on this information.</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        let materialsData = [];
        let charts = {};

        async function loadMaterialsData() {
            try {
                const response = await fetch('materialsData.csv');
                const csvText = await response.text();
                const lines = csvText.trim().split('\n');
                const headers = lines[0].split(',').map(h => h.trim());
                
                materialsData = lines.slice(1).map(line => {
                    const values = [];
                    let current = '';
                    let inQuotes = false;
                    
                    for (let i = 0; i < line.length; i++) {
                        const char = line[i];
                        if (char === '"') {
                            inQuotes = !inQuotes;
                        } else if (char === ',' && !inQuotes) {
                            values.push(current.trim());
                            current = '';
                        } else {
                            current += char;
                        }
                    }
                    values.push(current.trim()); 
                    
                    const material = {};
                    headers.forEach((header, index) => {
                        material[header] = values[index] || '';
                    });
                    return material;
                });

                materialsData.forEach(material => {
                    material.recyclabilityScore = calculateRecyclabilityScore(material);
                });

                console.log('Loaded materials:', materialsData);
                initializePage();
            } catch (error) {
                console.error('Error loading materials data:', error);
                document.querySelector('.overview-container').innerHTML = `
                    <div style="text-align: center; padding: 220px; font-size: 1.5rem; color: red; background-color: white; border-radius: 8px;">
                        <h2>Error Loading Data</h2>
                        <p>Could not load materials data. Please make sure materialsData.csv is accessible.</p>
                        <p>Error: ${error.message}</p>
                    </div>
                `;
                document.querySelector('.footer').style.display = 'none';
            }
        }

 
        function calculateRecyclabilityScore(material) {
            let score = 0;

            const categoryScores = {
                'Metal': 3.0,
                'Glass': 2.5,
                'Polymer': 2.0,
                'Ceramic': 1.0,
                'Composite': 0.5
            };
            score += categoryScores[material.Category] || 0;

            const thermalScores = {
                'Low': 0.5,
                'Moderate': 1.5,
                'High': 1.0,
                'Very High': 0.5
            };
            score += thermalScores[material['Thermal Stability']] || 0;

            const magneticScore = (material.Category === 'Metal' && material.Magnetism === 'Ferrous') ? 1.0 : 0.0;
            score += magneticScore;

            const meltingPoint = material['Melting Point']; // Celsius
            if (material.Category === 'Polymer') {
                if (meltingPoint < 200) {
                    score += 1.5;
                } else if (meltingPoint < 350) {
                    score += 1.0;
                } else {
                    score += 0.5;
                }
            } else if (material.Category === 'Metal') {
                if (meltingPoint < 300) {
                    score += 1.0;
                } else if (meltingPoint < 800) {
                    score += 1.5;
                }else if (meltingPoint < 1500) {
                    score += 1.2;
                } else {
                    score += 0.8;
                }
            } else if (material.Category === 'Glass' || material.Category === 'Ceramic') {
                if (meltingPoint < 1000) {
                    score += 1.5;
                } else if (meltingPoint < 1600) {
                    score += 1.0;
                } else {
                    score += 0.5;
                }
            }

            // Density (0â1), general heuristic
            const density = material.Density;
            if (density < 1.0) {
                score += 1.0;
            } else if (density < 3.0) {
                score += 0.5;
            }

            // Toxicity (0â2), inverse score
            const toxicityScores = {
                'Low': 2.0,
                'Moderate': 1.0,
                'High': 0.3,
                'Very High': 0.0
            };
            score += toxicityScores[material.Toxicity] || 0;

            // Polymer Type (0â1.5) â only if polymer
            const polymerTypeScores = {
                'PET': 1.5,
                'HDPE': 1.5,
                'PP': 1.0,
                'PVC': 0.5,
                'PS': 0.5,
                'Other': 0.0
            };
            if (material.Category === 'Polymer') {
                score += polymerTypeScores[material['Polymer Type']] || 0;
            }

            // Additives (penalty of up to -1)
            if (material.Category === 'Polymer' && material.Additives === 'Yes') {
                score -= 1.0;
            }
            let demandScore = 0.5;

            if (material.Category === 'Metal') {
                demandScore = material.Magnetism === 'Ferrous' ? 1.0 : 0.8; 
            } else if (material.Category === 'Glass') {
                demandScore = 1.0;
            } else if (material.Category === 'Polymer') {
                demandScore = ['PET', 'HDPE'].includes(material['Polymer Type']) ? 1.0 : 0.5;
            } else if (material.Category === 'Ceramic') {
                demandScore = 0.3;
            } else if (material.Category === 'Composite') {
                demandScore = 0.2;
            }

            score += demandScore;

            return Math.min(Math.max(Math.round(score * 100) / 100, 0), 10);      
        }

        // Initialize page content
        function initializePage() {
            updateSummaryCards();
            createCharts();
            populateTable();
            generateInsights();
        }

        // Update summary cards
        function updateSummaryCards() {
            const totalMaterials = materialsData.length;
            
            // Find best category by average score
            const categoryScores = {};
            materialsData.forEach(material => {
                if (!categoryScores[material.Category]) {
                    categoryScores[material.Category] = { total: 0, count: 0 };
                }
                categoryScores[material.Category].total += material.recyclabilityScore;
                categoryScores[material.Category].count++;
            });
            
            let bestCategory = '';
            let bestScore = 0;
            Object.keys(categoryScores).forEach(category => {
                const avgScore = categoryScores[category].total / categoryScores[category].count;
                if (avgScore > bestScore) {
                    bestScore = avgScore;
                    bestCategory = category;
                }
            });

            const highRiskCount = materialsData.filter(material => 
                material.Toxicity === 'High' || material.Toxicity === 'Very High'
            ).length;

            document.getElementById('total-materials').textContent = totalMaterials;
            document.getElementById('best-category').textContent = bestCategory;
            document.getElementById('high-risk').textContent = highRiskCount;
        }

        // Create all charts
        function createCharts() {
            createCategoryChart();
            createThermalChart();
        }

        // Category chart
        function createCategoryChart() {
            const ctx = document.getElementById('categoryChart').getContext('2d');
            
            const categoryData = {};
            materialsData.forEach(material => {
                if (!categoryData[material.Category]) {
                    categoryData[material.Category] = [];
                }
                categoryData[material.Category].push(material.recyclabilityScore);
            });

            const categories = Object.keys(categoryData);
            const averages = categories.map(category => {
                const scores = categoryData[category];
                return scores.reduce((sum, score) => sum + score, 0) / scores.length;
            });

            charts.category = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: categories,
                    datasets: [{
                        label: 'Average Recyclability Score',
                        data: averages,
                        backgroundColor: [
                            '#1a734c',
                            '#22a35c',
                            '#4fc3f7',
                            '#ff9800',
                            '#f44336'
                        ],
                        borderColor: '#fff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 10,
                            title: {
                                display: true,
                                text: 'Average Score'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Material Category'
                            }
                        }
                    }
                }
            });
        }

        // Thermal stability chart
        function createThermalChart() {
            const ctx = document.getElementById('thermalChart').getContext('2d');
            
            const categories = ['Metal', 'Polymer', 'Ceramic', 'Glass', 'Composite'];
            const thermalLevels = ['Low', 'Moderate', 'High', 'Very High'];
            
            const datasets = thermalLevels.map((level, index) => ({
                label: level,
                data: categories.map(category => {
                    return materialsData.filter(material => 
                        material.Category === category && material['Thermal Stability'] === level
                    ).length;
                }),
                backgroundColor: [
                    '#ffcdd2',
                    '#ffcc80',
                    '#c8e6c9',
                    '#1a734c'
                ][index]
            }));

            charts.thermal = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: categories,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            stacked: true,
                            title: {
                                display: true,
                                text: 'Material Category'
                            }
                        },
                        y: {
                            stacked: true,
                            title: {
                                display: true,
                                text: 'Number of Materials'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    }
                }
            });
        }

        // Populate materials table
        function populateTable() {
            const tbody = document.getElementById('materials-tbody');
            const sortedMaterials = [...materialsData].sort((a, b) => b.recyclabilityScore - a.recyclabilityScore);
            
            tbody.innerHTML = sortedMaterials.map(material => {
                const scoreClass = getScoreClass(material.recyclabilityScore);
                return `
                    <tr>
                        <td><strong>${material.Material}</strong></td>
                        <td><span class="category-badge ${material.Category.toLowerCase()}">${material.Category}</span></td>
                        <td><span class="score-badge ${scoreClass}">${material.recyclabilityScore.toFixed(1)}</span></td>
                        <td><span class="toxicity-badge ${getToxicityClass(material.Toxicity)}">${material.Toxicity}</span></td>
                        <td>${material['Thermal Stability']}</td>
                        <td>${material['Melting Point'] || 'N/A'}</td>
                        <td>${material.Density || 'N/A'}</td>
                    </tr>
                `;
            }).join('');
        }

        // Helper functions
        function getScoreClass(score) {
            if (score >= 8) return 'excellent';
            if (score >= 6) return 'good';
            if (score >= 4) return 'moderate';
            if (score >= 2) return 'fair';
            return 'poor';
        }

        function getToxicityClass(toxicity) {
            switch (toxicity) {
                case 'Low': return 'low';
                case 'Moderate': return 'moderate';
                case 'High': return 'high';
                case 'Very High': return 'very-high';
                default: return 'unknown';
            }
        }

        // Generate insights
        function generateInsights() {
            const insights = [];
            
            // Best performing material
            const bestMaterial = materialsData.reduce((best, current) => 
                current.recyclabilityScore > best.recyclabilityScore ? current : best
            );
            insights.push({
                title: 'Top Performer',
                content: `${bestMaterial.Material} has the highest recyclability score of ${bestMaterial.recyclabilityScore.toFixed(1)}/10`,
                icon: 'ð'
            });

            // Category insights
            const metalCount = materialsData.filter(m => m.Category === 'Metal').length;
            const totalCount = materialsData.length;
            insights.push({
                title: 'Metal Dominance',
                content: `Metals represent ${((metalCount/totalCount)*100).toFixed(1)}% of materials and generally have the highest recyclability scores`,
                icon: 'â¡'
            });

            // Toxicity insight
            const highToxicityCount = materialsData.filter(m => 
                m.Toxicity === 'High' || m.Toxicity === 'Very High'
            ).length;
            insights.push({
                title: 'Safety Concern',
                content: `${highToxicityCount} materials require special handling due to high toxicity levels`,
                icon: 'â ï¸'
            });

            // Processing insight
            const easyToProcess = materialsData.filter(m => 
                m.Category === 'Metal' && m.Magnetism === 'Ferrous'
            ).length;
            insights.push({
                title: 'Easy Processing',
                content: `${easyToProcess} ferrous metals can utilize magnetic separation for efficient recycling`,
                icon: 'ð§²'
            });

            const insightsGrid = document.getElementById('insights-grid');
            insightsGrid.innerHTML = insights.map(insight => `
                <div class="insight-card">
                    <div class="insight-icon">${insight.icon}</div>
                    <h4>${insight.title}</h4>
                    <p>${insight.content}</p>
                </div>
            `).join('');
        }

        // Filter functionality
        function setupFilters() {
            const categoryFilter = document.getElementById('category-filter');
            const toxicityFilter = document.getElementById('toxicity-filter');
            const searchFilter = document.getElementById('search-filter');

            function applyFilters() {
                let filteredData = materialsData;

                if (categoryFilter.value) {
                    filteredData = filteredData.filter(m => m.Category === categoryFilter.value);
                }

                if (toxicityFilter.value) {
                    filteredData = filteredData.filter(m => m.Toxicity === toxicityFilter.value);
                }

                if (searchFilter.value) {
                    const searchTerm = searchFilter.value.toLowerCase();
                    filteredData = filteredData.filter(m => 
                        m.Material.toLowerCase().includes(searchTerm)
                    );
                }

                updateTableWithFilteredData(filteredData);
            }

            categoryFilter.addEventListener('change', applyFilters);
            toxicityFilter.addEventListener('change', applyFilters);
            searchFilter.addEventListener('input', applyFilters);
        }

        function updateTableWithFilteredData(filteredData) {
            const tbody = document.getElementById('materials-tbody');
            const sortedMaterials = [...filteredData].sort((a, b) => b.recyclabilityScore - a.recyclabilityScore);
            
            tbody.innerHTML = sortedMaterials.map(material => {
                const scoreClass = getScoreClass(material.recyclabilityScore);
                return `
                    <tr>
                        <td><strong>${material.Material}</strong></td>
                        <td><span class="category-badge ${material.Category.toLowerCase()}">${material.Category}</span></td>
                        <td><span class="score-badge ${scoreClass}">${material.recyclabilityScore.toFixed(1)}</span></td>
                        <td><span class="toxicity-badge ${getToxicityClass(material.Toxicity)}">${material.Toxicity}</span></td>
                        <td>${material['Thermal Stability']}</td>
                        <td>${material['Melting Point'] || 'N/A'}</td>
                        <td>${material.Density || 'N/A'}</td>
                    </tr>
                `;
            }).join('');
        }

        // Search functionality
        document.getElementById('search-btn').addEventListener('click', function() {
            const searchTerm = document.getElementById('search-input').value;
            if (searchTerm.trim()) {
                window.location.href = `search.html?q=${encodeURIComponent(searchTerm)}`;
            } else {
                window.location.href = 'search.html';
            }
        });

        document.getElementById('search-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('search-btn').click();
            }
        });

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            loadMaterialsData();
            setupFilters();
        });
    </script>
</body>
</html>
